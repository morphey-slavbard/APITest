const request = require("request");

const options = {
  method: 'POST',
  url: 'https://dy-api.com/v2/serve/user/choose',
  headers: {
    'content-type': 'application/json',
    'dy-api-key': '308f1d6aee34e3ccca2d400f40f2318ab1b52757e7301efcbeedc5e17b756cf2' // Replace with your actual API key
  },
  body: JSON.stringify({
    user: {
      id: ""
    },
    session: { custom: "" },
    selector: { names: ["Home Page Top Banner"] },
    context: {
      page: {
        type: "HOMEPAGE",
        data: [""],
        location: "https://my-site.com",
        locale: "en_US"
      },
      pageAttributes: { is_night: "true" }
    },
    options: { isImplicitPageview: true }
  })
};

request(options, function (error, response, body) {
  if (error) {
    console.error('Error making API call:', error);
    return;
  }

  // Parse the JSON response from the API
  const data = JSON.parse(body);

  // Render the results in an HTML document
  renderResultsInHTML(data);
});

function renderResultsInHTML(data) {
  // Create the HTML content based on the received data
  const htmlContent = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>API Results</title>
    </head>
    <body>
        <h1>API Results</h1>
        <pre>${JSON.stringify(data, null, 2)}</pre>
    </body>
    </html>
  `;

  // Save the HTML content to a file (e.g., results.html)
  const fs = require('fs');
  fs.writeFileSync('results.html', htmlContent);

  console.log('HTML document generated: results.html');
}

